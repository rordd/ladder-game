<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸªœ ì‚¬ë‹¤ë¦¬ ê²Œì„</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#f093fb,#f5576c);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:10px}
.container{text-align:center;max-width:600px;width:100%;padding:10px}
h1{font-size:1.6em;color:#fff;margin-bottom:5px}
.sub{color:rgba(255,255,255,0.8);margin-bottom:10px;font-size:0.85em}
.setup{background:rgba(255,255,255,0.95);border-radius:16px;padding:15px;margin-bottom:10px}
.row{display:flex;align-items:center;justify-content:center;gap:6px;margin:6px 0;flex-wrap:wrap}
.row label{font-weight:bold;min-width:70px;text-align:right;font-size:0.9em}
.row input{padding:6px 10px;border:2px solid #ddd;border-radius:8px;font-size:0.9em;width:55px;text-align:center}
.names{display:flex;gap:5px;flex-wrap:wrap;justify-content:center;margin:8px 0}
.names input{padding:6px;border:2px solid #ddd;border-radius:8px;font-size:0.8em;width:75px;text-align:center}
.results-input{display:flex;gap:5px;flex-wrap:wrap;justify-content:center;margin:8px 0}
.results-input input{padding:6px;border:2px solid #e0a;border-radius:8px;font-size:0.8em;width:75px;text-align:center;background:#fff0f5}
.btn{background:linear-gradient(135deg,#f093fb,#f5576c);color:#fff;border:none;padding:10px 24px;font-size:1em;border-radius:50px;cursor:pointer;font-weight:bold;margin:4px;transition:transform 0.2s;-webkit-tap-highlight-color:transparent}
.btn:hover{transform:scale(1.05)}
.btn.small{padding:7px 16px;font-size:0.85em}
.btn.green{background:linear-gradient(135deg,#43e97b,#38f9d7)}
.btn.gray{background:#aaa}
canvas{background:#fff;border-radius:12px;margin:10px auto;display:block;box-shadow:0 4px 20px rgba(0,0,0,0.15);max-width:100%}
.result-box{background:rgba(255,255,255,0.95);border-radius:12px;padding:12px;margin-top:10px;font-size:0.95em;line-height:1.8}
.result-box span{display:inline-block;background:linear-gradient(135deg,#f093fb,#f5576c);color:#fff;padding:3px 10px;border-radius:20px;margin:2px;font-size:0.9em}
.hidden{display:none}
</style>
</head>
<body>
<div class="container">
<h1>ğŸªœ ì‚¬ë‹¤ë¦¬ ê²Œì„</h1>
<p class="sub">ì°¸ê°€ìì™€ ê²°ê³¼ë¥¼ ì…ë ¥í•˜ê³  ì‚¬ë‹¤ë¦¬ë¥¼ íƒ€ë³´ì„¸ìš”!</p>

<div class="setup" id="setup">
<div class="row">
<label>ì°¸ê°€ì ìˆ˜:</label>
<input type="number" id="numPlayers" value="4" min="2" max="8" onchange="updateNames()">
</div>
<div class="names" id="nameInputs"></div>
<div class="row"><label>ê²°ê³¼:</label></div>
<div class="results-input" id="resultInputs"></div>
<br>
<button class="btn" onclick="startGame()">ğŸªœ ì‚¬ë‹¤ë¦¬ ë§Œë“¤ê¸°!</button>
</div>

<div id="gameArea" class="hidden">
<canvas id="ladder"></canvas>
<div class="row" id="btnRow" style="justify-content:center;flex-wrap:wrap"></div>
<button class="btn small gray" onclick="resetGame()" style="margin-top:10px">ğŸ”„ ë‹¤ì‹œí•˜ê¸°</button>
<div class="result-box hidden" id="resultBox"></div>
</div>
</div>

<script>
let players=[],results=[],ladders=[],paths=[],canvas,ctx,W,H,cols,rowH,colW,revealed=[];
const colors=['#f5576c','#4facfe','#43e97b','#f7971e','#a18cd1','#fbc2eb','#00c9ff','#ff6b6b'];

function updateNames(){
const n=Math.min(Math.max(parseInt(document.getElementById('numPlayers').value)||4,2),8);
const nd=document.getElementById('nameInputs');
const rd=document.getElementById('resultInputs');
nd.innerHTML='';rd.innerHTML='';
for(let i=0;i<n;i++){
let ni=document.createElement('input');
ni.placeholder=`ì°¸ê°€ì${i+1}`;ni.id=`name${i}`;ni.value=`ì°¸ê°€ì${i+1}`;
nd.appendChild(ni);
let ri=document.createElement('input');
ri.placeholder=`ê²°ê³¼${i+1}`;ri.id=`res${i}`;
ri.value=['ë‹¹ì²¨!','ê½','ë²Œì¹™','ë©´ì œ','ì»¤í”¼ì‚¬ê¸°','ì²­ì†Œ','ë…¸ë˜','ê°„ì‹'][i]||`ê²°ê³¼${i+1}`;
rd.appendChild(ri);
}
}

function startGame(){
const n=parseInt(document.getElementById('numPlayers').value)||4;
players=[];results=[];
for(let i=0;i<n;i++){
players.push(document.getElementById(`name${i}`).value||`ì°¸ê°€ì${i+1}`);
results.push(document.getElementById(`res${i}`).value||`ê²°ê³¼${i+1}`);
}
// shuffle results
const sr=[...results];
for(let i=sr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[sr[i],sr[j]]=[sr[j],sr[i]];}
results=sr;
generateLadder(n);
drawLadder();
createButtons(n);
document.getElementById('setup').classList.add('hidden');
document.getElementById('gameArea').classList.remove('hidden');
document.getElementById('resultBox').classList.add('hidden');
revealed=[];
}

function computePaths(n,rows,grid){
let ps=[];
for(let start=0;start<n;start++){
let path=[];
let x=start;
for(let r=0;r<rows;r++){
if(x>0&&grid[r][x-1]){path.push({x,r,dir:'left'});x--;}
else if(x<n-1&&grid[r][x]){path.push({x,r,dir:'right'});x++;}
else{path.push({x,r,dir:'down'});}
}
path.push({x,r:rows,dir:'end'});
ps.push({steps:path,end:x});
}
return ps;
}
function generateLadder(n){
cols=n;
const rows=8;
let attempts=0;
// keep generating until all paths end at unique columns (valid permutation)
do{
ladders=[];
for(let r=0;r<rows;r++){
let row=[];
for(let c=0;c<cols-1;c++){
// no two adjacent bridges on same row
row.push(c>0&&row[c-1]?false:Math.random()<0.45);
}
ladders.push(row);
}
for(let c=0;c<cols-1;c++){
let has=ladders.some(r=>r[c]);
if(!has)ladders[Math.floor(Math.random()*rows)][c]=true;
}
paths=computePaths(n,rows,ladders);
let ends=paths.map(p=>p.end);
attempts++;
if(new Set(ends).size===n)break;
}while(attempts<500);
}

function drawLadder(){
canvas=document.getElementById('ladder');
const dpr=window.devicePixelRatio||1;
W=Math.min(500,window.innerWidth-30);
H=Math.min(450,window.innerHeight*0.5);
canvas.style.width=W+'px';canvas.style.height=H+'px';
canvas.width=W*dpr;canvas.height=H*dpr;
ctx=canvas.getContext('2d');
ctx.scale(dpr,dpr);
colW=W/(cols+1);
rowH=(H-80)/ladders.length;
ctx.clearRect(0,0,W,H);
// vertical lines
ctx.strokeStyle='#333';ctx.lineWidth=2;
for(let c=0;c<cols;c++){
let x=(c+1)*colW;
ctx.beginPath();ctx.moveTo(x,30);ctx.lineTo(x,H-40);ctx.stroke();
}
// horizontal bridges
ctx.strokeStyle='#999';ctx.lineWidth=2;
for(let r=0;r<ladders.length;r++){
for(let c=0;c<cols-1;c++){
if(ladders[r][c]){
let x1=(c+1)*colW,x2=(c+2)*colW;
let y=40+r*rowH;
ctx.beginPath();ctx.moveTo(x1,y);ctx.lineTo(x2,y);ctx.stroke();
}
}
}
// player names top
ctx.font='bold 13px sans-serif';ctx.textAlign='center';
for(let i=0;i<cols;i++){
ctx.fillStyle=colors[i%colors.length];
ctx.fillText(players[i],(i+1)*colW,20);
}
// result placeholders bottom
ctx.font='12px sans-serif';
for(let i=0;i<cols;i++){
ctx.fillStyle='#999';
ctx.fillText('???',(i+1)*colW,H-15);
}
}

function createButtons(n){
const row=document.getElementById('btnRow');
row.innerHTML='';
for(let i=0;i<n;i++){
let b=document.createElement('button');
b.className='btn small green';
b.textContent=players[i];
b.style.background=colors[i%colors.length];
b.onclick=(()=>{const idx=i;return()=>animatePath(idx);})();
b.id=`pbtn${i}`;
row.appendChild(b);
}
}

function animatePath(idx){
if(revealed.includes(idx))return;
revealed.push(idx);
document.getElementById(`pbtn${idx}`).style.opacity='0.4';
const path=paths[idx];
const color=colors[idx%colors.length];
let step=0;
function draw(){
if(step>=path.steps.length){
// reveal result
const endCol=path.end;
ctx.font='bold 13px sans-serif';ctx.textAlign='center';
ctx.fillStyle=color;
ctx.clearRect((endCol+1)*colW-40,H-28,80,18);
ctx.fillText(results[endCol],(endCol+1)*colW,H-15);
// show in result box
const box=document.getElementById('resultBox');
box.classList.remove('hidden');
box.innerHTML+='<span style="background:'+color+'">'+players[idx]+' â†’ '+results[endCol]+'</span> ';
return;
}
const s=path.steps[step];
const x=(s.x+1)*colW;
const y=40+s.r*rowH;
ctx.strokeStyle=color;ctx.lineWidth=3;ctx.lineCap='round';
if(step===0){
ctx.beginPath();ctx.moveTo(x,30);ctx.lineTo(x,y);ctx.stroke();
}else{
const ps=path.steps[step-1];
const px=(ps.x+1)*colW;
const py=40+ps.r*rowH;
ctx.beginPath();ctx.moveTo(px,py);
if(s.x!==ps.x){ctx.lineTo(x,py);ctx.lineTo(x,y);}
else{ctx.lineTo(x,y);}
ctx.stroke();
}
if(s.dir==='end'){
const ps=path.steps[step-1];
const px=(ps.x+1)*colW;
const py=40+ps.r*rowH;
ctx.beginPath();ctx.moveTo(x,py);ctx.lineTo(x,H-40);ctx.stroke();
}
step++;
setTimeout(draw,120);
}
draw();
}

function resetGame(){
document.getElementById('setup').classList.remove('hidden');
document.getElementById('gameArea').classList.add('hidden');
}

updateNames();
</script>
</body>
</html>
